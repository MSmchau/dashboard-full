<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Monitor è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
        }
        .success {
            background-color: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #2196f3;
        }
        button {
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #1976d2;
        }
        .network-test {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” Device Monitor é¡µé¢è°ƒè¯•å·¥å…·</h1>
        
        <div class="test-section">
            <h2>1. åŸºç¡€è¿æ¥æµ‹è¯•</h2>
            <button onclick="testBasicConnection()">æµ‹è¯•åŸºç¡€è¿æ¥</button>
            <div id="connection-result"></div>
        </div>

        <div class="test-section">
            <h2>2. ç½‘ç»œè¯·æ±‚æµ‹è¯•</h2>
            <div class="network-test">
                <button onclick="testAPIEndpoints()">æµ‹è¯•APIæ¥å£</button>
                <button onclick="testStaticAssets()">æµ‹è¯•é™æ€èµ„æº</button>
            </div>
            <div id="network-result"></div>
        </div>

        <div class="test-section">
            <h2>3. JavaScripté”™è¯¯æ£€æµ‹</h2>
            <button onclick="testJSErrors()">æ£€æµ‹JSé”™è¯¯</button>
            <div id="js-error-result"></div>
        </div>

        <div class="test-section">
            <h2>4. é¡µé¢å…ƒç´ æ£€æµ‹</h2>
            <button onclick="testPageElements()">æ£€æµ‹é¡µé¢å…ƒç´ </button>
            <div id="elements-result"></div>
        </div>

        <div class="test-section">
            <h2>5. æ€§èƒ½ç›‘æ§</h2>
            <button onclick="startPerformanceMonitor()">å¼€å§‹æ€§èƒ½ç›‘æ§</button>
            <button onclick="stopPerformanceMonitor()">åœæ­¢ç›‘æ§</button>
            <div id="performance-result"></div>
        </div>

        <div class="test-section">
            <h2>6. ä¿®å¤å»ºè®®</h2>
            <div id="repair-suggestions"></div>
        </div>
    </div>

    <script>
        let performanceInterval;

        // æµ‹è¯•åŸºç¡€è¿æ¥
        async function testBasicConnection() {
            const result = document.getElementById('connection-result');
            result.innerHTML = '<div class="test-result info">æ­£åœ¨æµ‹è¯•...</div>';
            
            try {
                const response = await fetch('/device-monitor', {
                    method: 'HEAD',
                    headers: {'Cache-Control': 'no-cache'}
                });
                
                if (response.ok) {
                    result.innerHTML = `
                        <div class="test-result success">
                            âœ… é¡µé¢å¯æ­£å¸¸è®¿é—® (${response.status})
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="test-result error">
                            âŒ é¡µé¢è®¿é—®å¼‚å¸¸ (${response.status})
                        </div>
                    `;
                }
            } catch (error) {
                result.innerHTML = `
                    <div class="test-result error">
                        âŒ é¡µé¢æ— æ³•è®¿é—®: ${error.message}
                    </div>
                `;
            }
        }

        // æµ‹è¯•APIæ¥å£
        async function testAPIEndpoints() {
            const result = document.getElementById('network-result');
            result.innerHTML = '<div class="test-result info">æ­£åœ¨æµ‹è¯•APIæ¥å£...</div>';
            
            const endpoints = [
                '/api/devices',
                '/api/metrics',
                '/api/health'
            ];
            
            let results = '';
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    results += `
                        <div class="test-result ${response.ok ? 'success' : 'error'}">
                            ${response.ok ? 'âœ…' : 'âŒ'} ${endpoint} - ${response.status}
                        </div>
                    `;
                } catch (error) {
                    results += `
                        <div class="test-result error">
                            âŒ ${endpoint} - æ— æ³•è¿æ¥: ${error.message}
                        </div>
                    `;
                }
            }
            
            result.innerHTML = results;
        }

        // æµ‹è¯•é™æ€èµ„æº
        async function testStaticAssets() {
            const result = document.getElementById('network-result');
            result.innerHTML += '<div class="test-result info">æ­£åœ¨æµ‹è¯•é™æ€èµ„æº...</div>';
            
            const assets = [
                '/src/main.ts',
                '/src/views/DeviceMonitor.vue',
                '/src/assets/logo.png'
            ];
            
            let results = '';
            
            for (const asset of assets) {
                try {
                    const response = await fetch(asset);
                    results += `
                        <div class="test-result ${response.ok ? 'success' : 'error'}">
                            ${response.ok ? 'âœ…' : 'âŒ'} ${asset} - ${response.status}
                        </div>
                    `;
                } catch (error) {
                    results += `
                        <div class="test-result error">
                            âŒ ${asset} - æ— æ³•åŠ è½½: ${error.message}
                        </div>
                    `;
                }
            }
            
            result.innerHTML += results;
        }

        // æ£€æµ‹JavaScripté”™è¯¯
        function testJSErrors() {
            const result = document.getElementById('js-error-result');
            
            // é‡ç½®é”™è¯¯æ•è·
            const originalError = window.onerror;
            const errors = [];
            
            window.onerror = function(msg, url, line, col, error) {
                errors.push({
                    message: msg,
                    source: url,
                    line: line,
                    column: col,
                    stack: error ? error.stack : 'N/A'
                });
                return false;
            };
            
            // ç­‰å¾…2ç§’æ”¶é›†é”™è¯¯
            setTimeout(() => {
                window.onerror = originalError;
                
                if (errors.length === 0) {
                    result.innerHTML = `
                        <div class="test-result success">
                            âœ… æœªæ£€æµ‹åˆ°JavaScripté”™è¯¯
                        </div>
                    `;
                } else {
                    let errorHtml = '<div class="test-result error">âŒ æ£€æµ‹åˆ°JavaScripté”™è¯¯:</div>';
                    errors.forEach((error, index) => {
                        errorHtml += `
                            <div class="test-result error">
                                <strong>é”™è¯¯ ${index + 1}:</strong><br>
                                æ¶ˆæ¯: ${error.message}<br>
                                æ–‡ä»¶: ${error.source}:${error.line}:${error.column}<br>
                                å †æ ˆ: ${error.stack}
                            </div>
                        `;
                    });
                    result.innerHTML = errorHtml;
                }
            }, 2000);
        }

        // æ£€æµ‹é¡µé¢å…ƒç´ 
        function testPageElements() {
            const result = document.getElementById('elements-result');
            
            const elements = {
                'device-monitor-container': 'device-monitoré¡µé¢å®¹å™¨',
                'device-list-panel': 'è®¾å¤‡åˆ—è¡¨é¢æ¿',
                'device-detail-panel': 'è®¾å¤‡è¯¦æƒ…é¢æ¿',
                'realtime-metrics': 'å®æ—¶æŒ‡æ ‡åŒºåŸŸ',
                'health-score': 'å¥åº·åº¦è¯„åˆ†',
                'historical-trends': 'å†å²è¶‹åŠ¿å›¾'
            };
            
            let results = '';
            
            for (const [id, description] of Object.entries(elements)) {
                const element = document.getElementById(id) || document.querySelector(`[class*="${id}"]`);
                if (element) {
                    results += `
                        <div class="test-result success">
                            âœ… ${description} - æ‰¾åˆ°å…ƒç´  (${element.tagName})
                        </div>
                    `;
                } else {
                    results += `
                        <div class="test-result error">
                            âŒ ${description} - å…ƒç´ ä¸å­˜åœ¨æˆ–ä¸å¯è§
                        </div>
                    `;
                }
            }
            
            result.innerHTML = results;
        }

        // å¼€å§‹æ€§èƒ½ç›‘æ§
        function startPerformanceMonitor() {
            const result = document.getElementById('performance-result');
            
            performanceInterval = setInterval(() => {
                if ('performance' in window && 'memory' in performance) {
                    const memInfo = performance.memory;
                    const memUsed = (memInfo.usedJSHeapSize / 1024 / 1024).toFixed(2);
                    const memTotal = (memInfo.totalJSHeapSize / 1024 / 1024).toFixed(2);
                    
                    result.innerHTML = `
                        <div class="test-result info">
                            ğŸ’¾ å†…å­˜ä½¿ç”¨: ${memUsed} MB / ${memTotal} MB
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="test-result info">
                            ğŸ“Š æ€§èƒ½ç›‘æ§ä¸å¯ç”¨ (éœ€è¦Chromeæµè§ˆå™¨)
                        </div>
                    `;
                }
            }, 1000);
        }

        // åœæ­¢æ€§èƒ½ç›‘æ§
        function stopPerformanceMonitor() {
            if (performanceInterval) {
                clearInterval(performanceInterval);
                performanceInterval = null;
                document.getElementById('performance-result').innerHTML = 
                    '<div class="test-result info">â¹ï¸ æ€§èƒ½ç›‘æ§å·²åœæ­¢</div>';
            }
        }

        // åˆå§‹åŒ–æ˜¾ç¤ºä¿®å¤å»ºè®®
        function initRepairSuggestions() {
            const suggestions = `
                <div class="test-result info">
                    <h3>ğŸ”§ Device Monitor é¡µé¢ä¿®å¤å»ºè®®:</h3>
                    <ol>
                        <li><strong>æ£€æŸ¥è·¯ç”±é…ç½®:</strong> ç¡®ä¿ /device-monitor è·¯ç”±æ­£ç¡®æŒ‡å‘ DeviceMonitor.vue ç»„ä»¶</li>
                        <li><strong>æ£€æŸ¥ç»„ä»¶å¯¼å…¥:</strong> éªŒè¯ DeviceMonitor.vue çš„å¯¼å…¥è·¯å¾„å’Œä¾èµ–é¡¹</li>
                        <li><strong>æ£€æŸ¥CSSæ ·å¼:</strong> ç¡®è®¤é¡µé¢æ ·å¼æ­£ç¡®åŠ è½½ï¼Œæ— æ ·å¼å†²çª</li>
                        <li><strong>æ£€æŸ¥JavaScripté”™è¯¯:</strong> åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</li>
                        <li><strong>æ£€æŸ¥APIæ•°æ®:</strong> ç¡®è®¤åç«¯APIæ¥å£æ­£å¸¸å·¥ä½œå¹¶è¿”å›æ•°æ®</li>
                        <li><strong>æ£€æŸ¥ç½‘ç»œè¯·æ±‚:</strong> åœ¨Networké¢æ¿æŸ¥çœ‹è¯·æ±‚çŠ¶æ€å’Œå“åº”</li>
                    </ol>
                </div>
            `;
            document.getElementById('repair-suggestions').innerHTML = suggestions;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            initRepairSuggestions();
            console.log('Device Monitor è°ƒè¯•å·¥å…·å·²åŠ è½½');
        });
    </script>
</body>
</html>