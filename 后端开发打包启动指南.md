# åç«¯å¼€å‘æ‰“åŒ…å¯åŠ¨æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—åŸºäºé¡¹ç›®è®¾è®¡å®¡æŸ¥ç»“æœï¼Œä¸ºåç«¯å¼€å‘æ‰“åŒ…å’Œå¯åŠ¨å·¥ä½œæä¾›å®Œæ•´çš„æ“ä½œæµç¨‹ã€‚ç³»ç»Ÿé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒ3000+è®¾å¤‡ç®¡ç†ï¼Œå…·å¤‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜æ‰©å±•æ€§ç‰¹ç‚¹ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è´Ÿè½½å‡è¡¡å™¨     â”‚    â”‚   APIç½‘å…³       â”‚    â”‚   æœåŠ¡æ³¨å†Œä¸­å¿ƒ   â”‚
â”‚   (Nginx)       â”‚â”€â”€â”€â”€â”‚   (Spring Gate) â”‚â”€â”€â”€â”€â”‚   (Eureka)      â”‚
â”‚   :80, :443     â”‚    â”‚   :8080         â”‚    â”‚   :8761         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¾å¤‡ç®¡ç†æœåŠ¡   â”‚    â”‚  æ•°æ®é‡‡é›†æœåŠ¡    â”‚    â”‚  å®æ—¶è®¡ç®—æœåŠ¡    â”‚
â”‚  device-service â”‚    â”‚data-collection  â”‚    â”‚ real-time-svc   â”‚
â”‚   :8081         â”‚    â”‚    :8082        â”‚    â”‚   :8083         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL    â”‚    â”‚     Kafka       â”‚    â”‚    Redis        â”‚
â”‚   :5432         â”‚    â”‚   :9092         â”‚    â”‚   :6379         â”‚
â”‚   ä¸»æ•°æ®åº“      â”‚    â”‚  æ¶ˆæ¯é˜Ÿåˆ—        â”‚    â”‚   ç¼“å­˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    InfluxDB     â”‚
                    â”‚   :8086         â”‚
                    â”‚  æ—¶åºæ•°æ®åº“      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ‰“åŒ…å‡†å¤‡

### 1. ç¯å¢ƒè¦æ±‚

**æœ€ä½ç³»ç»Ÿè¦æ±‚:**
- CPU: 4æ ¸å¿ƒ
- å†…å­˜: 8GB (æ¨è16GB)
- ç£ç›˜: 50GBå¯ç”¨ç©ºé—´
- æ“ä½œç³»ç»Ÿ: Linux (CentOS 7+/Ubuntu 18.04+)

**è½¯ä»¶ä¾èµ–:**
```bash
# Dockerå®‰è£…
curl -fsSL https://get.docker.com | bash
systemctl start docker
systemctl enable docker

# Docker Composeå®‰è£…
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Java 11+ (ç”¨äºæœ¬åœ°ç¼–è¯‘)
sudo apt update
sudo apt install openjdk-11-jdk maven

# Git
sudo apt install git
```

### 2. åç«¯æœåŠ¡æ‰“åŒ…

**å¾®æœåŠ¡ç›®å½•ç»“æ„:**
```
backend-services/
â”œâ”€â”€ eureka-server/          # æœåŠ¡æ³¨å†Œä¸­å¿ƒ
â”œâ”€â”€ gateway-server/         # APIç½‘å…³
â”œâ”€â”€ device-service/         # è®¾å¤‡ç®¡ç†æœåŠ¡
â”œâ”€â”€ data-collection-svc/    # æ•°æ®é‡‡é›†æœåŠ¡
â”œâ”€â”€ real-time-svc/          # å®æ—¶è®¡ç®—æœåŠ¡
â””â”€â”€ common/                 # å…¬å…±æ¨¡å—
    â”œâ”€â”€ common-security/    # å®‰å…¨æ¨¡å—
    â”œâ”€â”€ common-database/    # æ•°æ®åº“æ¨¡å—
    â””â”€â”€ common-util/        # å·¥å…·æ¨¡å—
```

**æ‰“åŒ…å‘½ä»¤:**
```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd d:\\Python\\dashboard-full

# æ„å»ºæ‰€æœ‰åç«¯æœåŠ¡
./linux-deploy-scripts/04-deploy.sh --check

# Mavenæ‰“åŒ… (å¦‚æœæœ¬åœ°æ„å»º)
mvn clean package -DskipTests

# Dockeré•œåƒæ„å»º
docker-compose build
```

## ğŸš€ å¯åŠ¨æµç¨‹

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½² (æ¨è)

```bash
# 1. è¿›å…¥éƒ¨ç½²è„šæœ¬ç›®å½•
cd d:\\Python\\dashboard-full\\linux-deploy-scripts

# 2. ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥
./04-deploy.sh --check

# 3. å¼€å‘ç¯å¢ƒå¿«é€Ÿå¯åŠ¨
./04-deploy.sh -e dev --mode quick

# 4. ç”Ÿäº§ç¯å¢ƒå®Œæ•´éƒ¨ç½²
./04-deploy.sh -e prod --mode full --backup
```

### æ–¹å¼äºŒï¼šåˆ†æ­¥å¯åŠ¨

```bash
# 1. å¯åŠ¨åŸºç¡€è®¾æ–½æœåŠ¡
docker-compose -f 02-docker-compose.yml up -d postgresql redis kafka influxdb

# 2. ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ– (çº¦30ç§’)
sleep 30

# 3. å¯åŠ¨å¾®æœåŠ¡
docker-compose -f 02-docker-compose.yml up -d eureka-server gateway-server

# 4. ç­‰å¾…æœåŠ¡æ³¨å†Œå®Œæˆ (çº¦20ç§’)
sleep 20

# 5. å¯åŠ¨ä¸šåŠ¡æœåŠ¡
docker-compose -f 02-docker-compose.yml up -d device-service data-collection-svc real-time-svc

# 6. å¯åŠ¨ç›‘æ§æœåŠ¡
docker-compose -f 02-docker-compose.yml up -d prometheus grafana
```

### æ–¹å¼ä¸‰ï¼šå¼€å‘æ¨¡å¼å¯åŠ¨

```bash
# å¯åŠ¨å¼€å‘ç¯å¢ƒ (çƒ­æ›´æ–°)
export SPRING_PROFILES_ACTIVE=dev
export EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://localhost:8761/eureka/

# ä¾æ¬¡å¯åŠ¨æœåŠ¡
java -jar eureka-server/target/eureka-server.jar
java -jar gateway-server/target/gateway-server.jar  
java -jar device-service/target/device-service.jar
java -jar data-collection-svc/target/data-collection-svc.jar
java -jar real-time-svc/target/real-time-svc.jar
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

ä¸»è¦é…ç½®é¡¹ä½äº `03-environment.env`:

```bash
# æ•°æ®åº“é…ç½®
DB_PASSWORD=device_admin_123
DATABASE_HOST=postgresql
DATABASE_NAME=device_management

# JWTè®¤è¯
JWT_SECRET=device_jwt_secret_key_123456789
JWT_EXPIRE_TIME=86400

# æ€§èƒ½å‚æ•°
JAVA_OPTS=-Xms2g -Xmx4g -XX:+UseG1GC
POSTGRESQL_MAX_CONNECTIONS=500
MAX_ONLINE_DEVICES=3000
```

### æœåŠ¡ç«¯å£é…ç½®

| æœåŠ¡ | ç«¯å£ | æè¿° |
|------|------|------|
| PostgreSQL | 5432 | ä¸»æ•°æ®åº“ |
| Redis | 6379 | ç¼“å­˜æœåŠ¡ |
| InfluxDB | 8086 | æ—¶åºæ•°æ®åº“ |
| Kafka | 9092 | æ¶ˆæ¯é˜Ÿåˆ— |
| Eureka | 8761 | æœåŠ¡æ³¨å†Œä¸­å¿ƒ |
| Gateway | 8080 | APIç½‘å…³ |
| è®¾å¤‡æœåŠ¡ | 8081 | è®¾å¤‡ç®¡ç† |
| æ•°æ®é‡‡é›† | 8082 | æ•°æ®æ”¶é›† |
| å®æ—¶è®¡ç®— | 8083 | æµå¤„ç† |

## ğŸ“Š å¯åŠ¨éªŒè¯

### 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker ps

# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:8761/actuator/health
curl http://localhost:8080/actuator/health
curl http://localhost:8081/actuator/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec device-postgresql psql -U device_admin -d device_management -c "SELECT version();"
```

### 2. åŠŸèƒ½éªŒè¯

**APIæ¥å£æµ‹è¯•:**
```bash
# è®¾å¤‡ç®¡ç†APIæµ‹è¯•
curl -X GET "http://localhost:8080/api/devices" \
  -H "Authorization: Bearer <JWT_TOKEN>"

# å®æ—¶æ•°æ®APIæµ‹è¯•  
curl -X GET "http://localhost:8080/api/devices/realtime" \
  -H "Authorization: Bearer <JWT_TOKEN>"

# å‘Šè­¦æ•°æ®APIæµ‹è¯•
curl -X GET "http://localhost:8080/api/alerts" \
  -H "Authorization: Bearer <JWT_TOKEN>"
```

**WebSocketè¿æ¥æµ‹è¯•:**
```javascript
// æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•
const ws = new WebSocket('ws://localhost:8080/ws/realtime');
ws.onopen = () => console.log('WebSocketè¿æ¥æˆåŠŸ');
ws.onmessage = (event) => console.log('å®æ—¶æ•°æ®:', event.data);
```

### 3. ç›‘æ§é¢æ¿è®¿é—®

| ç»„ä»¶ | è®¿é—®åœ°å€ | ç”¨æˆ·å | å¯†ç  |
|------|----------|--------|------|
| Grafana | http://localhost:3000 | admin | admin_123 |
| Prometheus | http://localhost:9090 | - | - |
| APIæ–‡æ¡£ | http://localhost:8080/swagger-ui.html | - | - |

## ğŸ”§ å¸¸è§é—®é¢˜å¤„ç†

### é—®é¢˜1: æ•°æ®åº“è¿æ¥å¤±è´¥

**ç°è±¡**: è®¾å¤‡æœåŠ¡å¯åŠ¨æŠ¥é”™æ— æ³•è¿æ¥æ•°æ®åº“
**è§£å†³**:
```bash
# æ£€æŸ¥æ•°æ®åº“å®¹å™¨çŠ¶æ€
docker ps | grep postgresql

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker logs device-postgresql

# é‡å¯æ•°æ®åº“æœåŠ¡
docker-compose restart postgresql
```

### é—®é¢˜2: æœåŠ¡æ³¨å†Œå¤±è´¥

**ç°è±¡**: æœåŠ¡æ— æ³•åœ¨Eurekaä¸­æ³¨å†Œ
**è§£å†³**:
```bash
# æ£€æŸ¥EurekaæœåŠ¡çŠ¶æ€
curl http://localhost:8761/eureka/apps

# æ£€æŸ¥æœåŠ¡æ³¨å†Œé…ç½®
grep -r "eureka.client" ./*/src/main/resources/

# é‡å¯ç›¸å…³æœåŠ¡
docker-compose restart gateway-server device-service
```

### é—®é¢˜3: å†…å­˜ä¸è¶³

**ç°è±¡**: å®¹å™¨å¯åŠ¨å¤±è´¥æˆ–è¢«æ€æ­»
**è§£å†³**:
```bash
# æ£€æŸ¥ç³»ç»Ÿèµ„æº
free -h
df -h

# è°ƒæ•´JVMå‚æ•°
export JAVA_OPTS="-Xms1g -Xmx2g -XX:+UseG1GC"

# å‡å°‘å®¹å™¨æ•°é‡
docker-compose up -d postgresql redis device-service
```

### é—®é¢˜4: ç«¯å£å†²çª

**ç°è±¡**: ç«¯å£è¢«å ç”¨å¯åŠ¨å¤±è´¥
**è§£å†³**:
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8080

# ä¿®æ”¹ç«¯å£é…ç½®
sed -i 's/8080:8080/8081:8080/g' 02-docker-compose.yml

# é‡æ–°å¯åŠ¨
docker-compose down && docker-compose up -d
```

## ğŸ“ˆ æ€§èƒ½è°ƒä¼˜

### æ•°æ®åº“ä¼˜åŒ–

```sql
-- è¿æ¥æ± ä¼˜åŒ–
ALTER SYSTEM SET max_connections = 500;
ALTER SYSTEM SET shared_buffers = '256MB';
ALTER SYSTEM SET effective_cache_size = '1GB';

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX CONCURRENTLY idx_device_status_time ON device_status(timestamp DESC);
CREATE INDEX CONCURRENTLY idx_alerts_device_severity ON alerts(device_id, severity);
```

### JVMè°ƒä¼˜

```bash
# ç”Ÿäº§ç¯å¢ƒJVMå‚æ•°
JAVA_OPTS="-Xms4g -Xmx8g -XX:+UseG1GC \
  -XX:MaxGCPauseMillis=200 -XX:G1HeapRegionSize=32m \
  -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap"
```

### Kafkaä¼˜åŒ–

```yaml
# Kafkaæ€§èƒ½è°ƒä¼˜
KAFKA_NUM_PARTITIONS: 12
KAFKA_DEFAULT_REPLICATION_FACTOR: 3
KAFKA_LOG_RETENTION_HOURS: 168
KAFKA_LOG_RETENTION_BYTES: 5368709120
```

## ğŸ” å®‰å…¨é…ç½®

### SSL/TLSé…ç½®

```yaml
# Nginx SSLé…ç½®
server {
    listen 443 ssl http2;
    server_name your-domain.com;
    
    ssl_certificate /etc/ssl/certs/device-management.crt;
    ssl_certificate_key /etc/ssl/private/device-management.key;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    
    location / {
        proxy_pass http://gateway-server:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### ç½‘ç»œå®‰å…¨

```bash
# é˜²ç«å¢™é…ç½®
ufw allow 22/tcp    # SSH
ufw allow 80/tcp    # HTTP
ufw allow 443/tcp   # HTTPS
ufw enable

# å®¹å™¨ç½‘ç»œå®‰å…¨
docker network create --subnet=172.20.0.0/16 device-network
```

## ğŸ”„ æ—¥å¿—ç®¡ç†

### æ—¥å¿—æ”¶é›†é…ç½®

```yaml
# Filebeaté…ç½® (ELK Stack)
filebeat.inputs:
- type: container
  paths:
    - /var/lib/docker/containers/*/*.log
  processors:
  - add_docker_metadata: ~

output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  index: "device-logs-%{+yyyy.MM.dd}"
```

### æ—¥å¿—è½®è½¬

```bash
# Dockeræ—¥å¿—è½®è½¬é…ç½®
cat > /etc/docker/daemon.json << EOF
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m",
    "max-file": "3"
  }
}
EOF

systemctl restart docker
```

## ğŸš€ å¯åŠ¨å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥é€šè¿‡
- [ ] Dockerå’ŒDocker Composeå®‰è£…æˆåŠŸ
- [ ] æ•°æ®åº“æœåŠ¡å¯åŠ¨å¹¶å¯è¿æ¥
- [ ] Redisç¼“å­˜æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] Kafkaæ¶ˆæ¯é˜Ÿåˆ—åˆå§‹åŒ–å®Œæˆ
- [ ] EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒè¿è¡Œ
- [ ] APIç½‘å…³å¯åŠ¨æˆåŠŸ
- [ ] è®¾å¤‡ç®¡ç†æœåŠ¡æ³¨å†Œå®Œæˆ
- [ ] æ•°æ®é‡‡é›†æœåŠ¡æ­£å¸¸
- [ ] å®æ—¶è®¡ç®—æœåŠ¡è¿è¡Œ
- [ ] ç›‘æ§æœåŠ¡(Prometheus/Grafana)å¯åŠ¨
- [ ] APIæ¥å£æµ‹è¯•é€šè¿‡
- [ ] WebSocketè¿æ¥æ­£å¸¸
- [ ] ç›‘æ§é¢æ¿å¯è®¿é—®
- [ ] æ—¥å¿—æ”¶é›†é…ç½®å®Œæˆ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ–¹å¼è·å–æ”¯æŒï¼š

1. **æŸ¥çœ‹æ—¥å¿—**: `docker-compose logs <service-name>`
2. **ç³»ç»Ÿæ£€æŸ¥**: `./04-deploy.sh --check`
3. **å¥åº·æ£€æŸ¥**: `curl http://localhost:8080/actuator/health`
4. **è”ç³»å¼€å‘å›¢é˜Ÿ**: dashboard-dev@example.com

---

*å¯åŠ¨æŒ‡å—ç‰ˆæœ¬: v1.0*  
*æœ€åæ›´æ–°: 2025å¹´6æœˆ*  
*é€‚ç”¨ç³»ç»Ÿç‰ˆæœ¬: è®¾å¤‡ç®¡ç†ç³»ç»Ÿ v1.0*